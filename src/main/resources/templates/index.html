<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DevNest - 개발자 커뮤니티</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    :root {
      --primary-color: #6366F1;
      --primary-hover: #5856EB;
      --background-color: #F8F9FA;
      --border-color: #E9ECEF;
      --text-primary: #1F2937;
      --text-secondary: #6B7280;
      --card-background: #FFFFFF;
      --success-color: #10B981;
      --warning-color: #F59E0B;
      --danger-color: #EF4444;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--background-color);
      color: var(--text-primary);
    }

    .navbar {
      background-color: var(--card-background);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 0;
    }

    .navbar-brand {
      font-weight: 700;
      font-size: 1.5rem;
      color: var(--primary-color) !important;
      text-decoration: none;
    }

    .btn-primary-custom {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary-custom:hover {
      background-color: var(--primary-hover);
      border-color: var(--primary-hover);
      color: white;
      text-decoration: none;
    }

    .search-box {
      position: relative;
      max-width: 400px;
    }

    .search-box input {
      padding-right: 40px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
    }

    .search-box button {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-secondary);
    }

    .notification-dropdown {
      position: relative;
    }

    .notification-icon-button {
      background: none;
      border: none;
      padding: 0.5rem;
      border-radius: 50%;
      color: var(--text-secondary);
      position: relative;
    }

    .notification-icon-button:hover {
      background-color: #F3F4F6;
    }

    .notification-badge {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: var(--danger-color);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .dropdown-menu {
      min-width: 300px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--border-color);
      padding: 0;
    }

    .dropdown-header {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border-color);
      font-weight: 600;
      color: var(--text-primary);
    }

    .dropdown-item {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #F3F4F6;
      white-space: normal;
      cursor: pointer;
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background-color: #F8F9FA;
    }

    .notification-content {
      font-size: 0.875rem;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .notification-time {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .dropdown-footer {
      padding: 0.75rem 1rem;
      border-top: 1px solid var(--border-color);
      text-align: center;
    }

    .dropdown-footer a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
    }

    .dropdown-footer a:hover {
      text-decoration: underline;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--background-color);
      color: var(--text-primary);
    }

    .btn-primary-custom {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      font-weight: 500;
    }

    .btn-primary-custom:hover {
      background-color: var(--primary-hover);
      border-color: var(--primary-hover);
    }

    .search-input {
      border-color: #D1D5DB;
      padding-left: 2.5rem;
      height: 42px;
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #000;
    }

    .main-container {
      max-width: 1272px;
      margin: 0 auto;
      padding: 1.5rem 1rem;
    }

    .card-custom {
      background-color: var(--card-background);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .discussion-item {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .discussion-item:last-child {
      border-bottom: none;
    }

    .tag {
      background-color: #F3F4F6;
      color: var(--text-secondary);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .stats-item {
      text-align: center;
      padding: 1rem;
    }

    .stats-number {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .avatar {
      width: 37px;
      height: 37px;
      border-radius: 50%;
      object-fit: cover;
    }

    .avatar-lg {
      width: 49px;
      height: 49px;
    }

    .notification-header {
      border-bottom: 1px solid #F3F4F6;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .notification-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .notification-item {
      border-bottom: 1px solid #F3F4F6;
      padding: 1rem;
      transition: background-color 0.2s;
      cursor: pointer;
    }

    .notification-item:hover {
      background-color: #F9FAFB;
    }

    .notification-item.unread {
      background-color: #F8F9FA;
    }

    .notification-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-top: 0.25rem;
      flex-shrink: 0;
    }

    .notification-dot.unread {
      background-color: var(--unread-dot-color);
    }

    .notification-dot.read {
      background-color: var(--read-dot-color);
    }

    .notification-footer {
      border-top: 1px solid #F3F4F6;
      padding: 1rem;
      text-align: center;
    }

    .btn-link-custom {
      color: var(--primary-color);
      font-weight: 500;
      text-decoration: none;
      transition: color 0.2s;
    }

    .btn-link-custom:hover {
      color: var(--primary-hover);
    }

    @media (max-width: 768px) {
      .main-container {
        padding: 1rem 0.5rem;
      }

      .navbar-custom .container-fluid {
        padding: 0 1rem;
      }
    }

    .profile-icon-button {
      background: none;
      border: none;
      padding: 0.25rem;
      border-radius: 50%;
      color: var(--text-secondary);
    }

    .profile-icon-button img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
    }
  </style>
</head>
<body>

<!--  Navbar  -->
<nav class="navbar">
  <div class="container-fluid">
    <div class="d-flex align-items-center gap-3">
      <a class="navbar-brand" href="/">DevNest</a>
    </div>

    <div class="d-flex align-items-center gap-3">
      <div class="search-box">
        <input type="text" class="form-control" placeholder="질문 검색...">
        <button type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round" data-lucide="search" style="width: 16px; height: 16px;"
               class="lucide lucide-search">
            <path d="m21 21-4.34-4.34"></path>
            <circle cx="11" cy="11" r="8"></circle>
          </svg>
        </button>
      </div>

      <a href="/ask_question.html" class="btn-primary-custom">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
             stroke-linejoin="round" data-lucide="plus" style="width: 16px; height: 16px;"
             class="lucide lucide-plus">
          <path d="M5 12h14"></path>
          <path d="M12 5v14"></path>
        </svg>
        질문하기
      </a>

      <div th:if="${sessionUser != null}">
        <form method="post" action="/member/logout">
          <button type="submit" class="btn-primary-custom">로그아웃</button>
        </form>
      </div>

      <!-- Notification Dropdown -->
      <div class="notification-dropdown dropdown">
        <button class="notification-icon-button" type="button" id="notificationDropdown"
                data-bs-toggle="dropdown" aria-expanded="false">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round" data-lucide="bell" style="width: 24px; height: 24px;"
               class="lucide lucide-bell">
            <path d="M10.268 21a2 2 0 0 0 3.464 0"></path>
            <path
                d="M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"></path>
          </svg>
          <span class="notification-badge">3</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationDropdown">
          <li class="dropdown-header">알림</li>
          <li>
            <a class="dropdown-item" href="#">
              <div class="notification-content">새로운 답변이 등록되었습니다: "React Hooks 사용법"</div>
              <div class="notification-time">5분 전</div>
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#">
              <div class="notification-content">회원님의 질문에 새로운 댓글이 달렸습니다: "Spring Security 설정"</div>
              <div class="notification-time">1시간 전</div>
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#">
              <div class="notification-content">관리자 공지: 시스템 점검 안내</div>
              <div class="notification-time">어제</div>
            </a>
          </li>
          <li class="dropdown-footer">
            <a href="/all_notifications.html">모든 알림 보기</a>
          </li>
        </ul>
      </div>

      <!-- 로그인 시 나타나며 누르면 프로필 상세 페이지로-->
      <div th:if="${sessionUser != null}">
        <a href="/member/profile" class="profile-icon-button">
          <img
              src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiNGM0Y0RjYiLz4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxMiIgcj0iNCIgZmlsbD0iIzZCNzI4MCIvPgo8cGF0aCBkPSJNOCAyNGMwLTQuNCAzLjYtOCA4LThzOCAzLjYgOCA4IiBmaWxsPSIjNkI3MjgwIi8+Cjwvc3ZnPgo="
              alt="프로필">
        </a>
      </div>

      <div th:if="${sessionUser == null}">
        <a href="/member/login" class="btn-primary-custom">로그인</a>
        <a href="/member/signup" class="btn-primary-custom">회원가입</a>
      </div>
    </div>
  </div>
</nav>


<!-- Notification Dropdown Modal -->
<div id="notification-modal" class="notification-dropdown d-none">
  <!-- Header -->
  <div class="notification-header">
    <h3 class="h5 mb-0 fw-semibold">알림</h3>
    <button type="button" class="btn btn-link-custom" onclick="markAllNotificationsAsRead()">
      모두 읽음
    </button>
  </div>

  <!-- Notifications List -->
  <div class="notification-list" id="notification-list-content">
    <!-- Notifications will be rendered here by JavaScript -->
  </div>

  <!-- Footer -->
  <div class="notification-footer">
    <button type="button" class="btn btn-outline-primary w-100"
            onclick="viewAllNotificationsPage()">
      전체 보기
    </button>
  </div>
</div>

<!-- Main Content -->
<div class="main-container">
  <div class="row g-4">
    <!-- Left Column - Latest Discussions -->
    <div class="col-xl-4 col-lg-6">
      <div class="card card-custom">
        <div class="card-header bg-white border-bottom">
          <h5 class="card-title mb-0 fw-semibold">최신 토론</h5>
        </div>
        <div class="card-body p-0">
          <!-- Discussion Item 1 -->
          <div class="discussion-item">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h6 class="mb-1 fw-semibold">React에서 상태 관리 라이브러리 선택</h6>
              <small class="text-muted">2시간 전</small>
            </div>
            <p class="text-muted small mb-2">Redux vs Zustand vs Context API 중 어떤 것을 선택해야 할까요?</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex gap-1">
                <span class="tag">React</span>
                <span class="tag">상태관리</span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <small class="text-muted">답변 5</small>
                <small class="text-muted">조회 23</small>
              </div>
            </div>
          </div>

          <!-- Discussion Item 2 -->
          <div class="discussion-item">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h6 class="mb-1 fw-semibold">Spring Boot 성능 최적화 방법</h6>
              <small class="text-muted">4시간 전</small>
            </div>
            <p class="text-muted small mb-2">대용량 트래픽 처리를 위한 Spring Boot 최적화 팁을 공유해주세요.</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex gap-1">
                <span class="tag">Spring</span>
                <span class="tag">성능</span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <small class="text-muted">답변 8</small>
                <small class="text-muted">조회 45</small>
              </div>
            </div>
          </div>

          <!-- Discussion Item 3 -->
          <div class="discussion-item">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h6 class="mb-1 fw-semibold">Docker 컨테이너 배포 전략</h6>
              <small class="text-muted">6시간 전</small>
            </div>
            <p class="text-muted small mb-2">프로덕션 환경에서 Docker 컨테이너를 안전하게 배포하는 방법은?</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex gap-1">
                <span class="tag">Docker</span>
                <span class="tag">DevOps</span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <small class="text-muted">답변 3</small>
                <small class="text-muted">조회 18</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Center Column - Popular Topics -->
    <div class="col-xl-4 col-lg-6">
      <div class="card card-custom">
        <div class="card-header bg-white border-bottom">
          <h5 class="card-title mb-0 fw-semibold">인기 주제</h5>
        </div>
        <div class="card-body p-0">
          <!-- Topic Item 1 -->
          <div class="discussion-item">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h6 class="mb-1 fw-semibold">JavaScript ES2024 새로운 기능들</h6>
              <small class="text-muted">인기</small>
            </div>
            <p class="text-muted small mb-2">ES2024에서 추가된 새로운 기능들을 살펴보고 실무에서 활용하는 방법을 논의해봅시다.</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex gap-1">
                <span class="tag">JavaScript</span>
                <span class="tag">ES2024</span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <small class="text-muted">답변 12</small>
                <small class="text-muted">조회 89</small>
              </div>
            </div>
          </div>

          <!-- Topic Item 2 -->
          <div class="discussion-item">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h6 class="mb-1 fw-semibold">AI 개발자 도구 활용법</h6>
              <small class="text-muted">트렌딩</small>
            </div>
            <p class="text-muted small mb-2">GitHub Copilot, ChatGPT 등 AI 도구를 개발에 효과적으로 활용하는 방법</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex gap-1">
                <span class="tag">AI</span>
                <span class="tag">도구</span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <small class="text-muted">답변 15</small>
                <small class="text-muted">조회 67</small>
              </div>
            </div>
          </div>

          <!-- Topic Item 3 -->
          <div class="discussion-item">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h6 class="mb-1 fw-semibold">마이크로서비스 아키텍처 설계</h6>
              <small class="text-muted">주목</small>
            </div>
            <p class="text-muted small mb-2">대규모 시스템을 위한 마이크로서비스 아키텍처 설계 원칙과 실제 구현 사례</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex gap-1">
                <span class="tag">아키텍처</span>
                <span class="tag">마이크로서비스</span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <small class="text-muted">답변 9</small>
                <small class="text-muted">조회 54</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - Tags and Stats -->
    <div class="col-xl-4 col-12">
      <!-- Popular Tags -->
      <div class="card card-custom mb-4">
        <div class="card-header bg-white border-bottom">
          <h5 class="card-title mb-0 fw-semibold">인기 태그</h5>
        </div>
        <div class="card-body">
          <div class="d-flex flex-wrap gap-2">
            <span class="tag">JavaScript</span>
            <span class="tag">React</span>
            <span class="tag">Python</span>
            <span class="tag">Spring Boot</span>
            <span class="tag">Docker</span>
            <span class="tag">AWS</span>
            <span class="tag">Node.js</span>
            <span class="tag">TypeScript</span>
            <span class="tag">Vue.js</span>
            <span class="tag">MongoDB</span>
            <span class="tag">PostgreSQL</span>
            <span class="tag">Redis</span>
          </div>
        </div>
      </div>

      <!-- Community Stats -->
      <div class="card card-custom">
        <div class="card-header bg-white border-bottom">
          <h5 class="card-title mb-0 fw-semibold">커뮤니티 통계</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6 col-md-3 col-lg-6 stats-item">
              <div class="stats-number">1,234</div>
              <p class="text-muted mb-0">총 질문</p>
            </div>
            <div class="col-6 col-md-3 col-lg-6 stats-item">
              <div class="stats-number">567</div>
              <p class="text-muted mb-0">활성 사용자</p>
            </div>
            <div class="col-6 col-md-3 col-lg-6 stats-item">
              <div class="stats-number">89</div>
              <p class="text-muted mb-0">오늘 답변</p>
            </div>
            <div class="col-6 col-md-3 col-lg-6 stats-item">
              <div class="stats-number">23</div>
              <p class="text-muted mb-0">새 멤버</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  lucide.createIcons();

  // Notification Data (same as notification_modal.html for consistency)
  const notificationsData = [
    {
      id: "1",
      type: "answer",
      user: "개발자123",
      title: "React Hook에서 useEffect 의존성 배열 관련 질문입니다",
      message: "가 새로운 답변을 달았습니다.",
      time: "5분 전",
      read: false,
    },
    {
      id: "2",
      type: "accept",
      message: "회원님의 답변이 채택되었습니다.",
      time: "1시간 전",
      read: false,
    },
    {
      id: "3",
      type: "recommend",
      message: "회원님의 답변이 추천되었습니다.",
      time: "3시간 전",
      read: true,
    },
    {
      id: "4",
      type: "answer",
      user: "JS마스터",
      title: "JavaScript 클로저와 스코프 완벽 이해하기",
      message: "가 새로운 답변을 달았습니다.",
      time: "6시간 전",
      read: true,
    },
    {
      id: "5",
      type: "accept",
      message: "회원님의 답변이 채택되었습니다.",
      time: "1일 전",
      read: true,
    },
  ];

  function renderNotificationModal() {
    const notificationListContent = document.getElementById("notification-list-content");
    notificationListContent.innerHTML = "";

    notificationsData.slice(0, 5).forEach(notification => {
      const notificationItem = document.createElement("div");
      notificationItem.className = `notification-item d-flex align-items-start gap-3 ${notification.read
          ? "" : "unread"}`;
      notificationItem.innerHTML = `
                    <div class="notification-dot ${notification.read ? "read" : "unread"}"></div>
                    <div class="flex-grow-1">
                        <div class="d-flex align-items-start gap-1">
                            ${notification.user
          ? `<span class="small fw-semibold">${notification.user}</span>` : ``}
                            <span class="small">${notification.message}</span>
                        </div>
                        ${notification.title ? `
                        <div class="mt-1">
                            <span class="small text-muted">글 제목: </span>
                            <span class="small fw-medium">${notification.title}</span>
                        </div>
                        ` : ``}
                        <div class="small text-muted mt-2">${notification.time}</div>
                    </div>
                `;
      notificationListContent.appendChild(notificationItem);
    });
  }

  function markAllNotificationsAsRead() {
    notificationsData.forEach(notification => notification.read = true);
    renderNotificationModal();
    updateNotificationBell();
  }

  function viewAllNotificationsPage() {
    window.location.href = "/all_notifications.html";
  }

  function toggleNotificationModal() {
    const modal = document.getElementById("notification-modal");
    if (modal.classList.contains("d-none")) {
      modal.classList.remove("d-none");
    } else {
      modal.classList.add("d-none");
    }
  }

  function updateNotificationBell() {
    const unreadCount = notificationsData.filter(n => !n.read).length;
    const bellButton = document.getElementById("notification-bell-button");
    let unreadDot = document.getElementById("notification-unread-dot");

    if (unreadCount > 0) {
      if (!unreadDot) {
        unreadDot = document.createElement("div");
        unreadDot.id = "notification-unread-dot";
        unreadDot.className = "position-absolute top-0 start-100 translate-middle badge border border-light rounded-circle bg-danger p-1";
        bellButton.appendChild(unreadDot);
      }
    } else {
      if (unreadDot) {
        unreadDot.remove();
      }
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    renderNotificationModal();
    updateNotificationBell();
  });

  // Close modal when clicking outside
  document.addEventListener("click", (event) => {
    const modal = document.getElementById("notification-modal");
    const bellButton = document.getElementById("notification-bell-button");
    if (modal && bellButton && !modal.contains(event.target) && !bellButton.contains(
        event.target)) {
      modal.classList.add("d-none");
    }
  });
</script>
</body>
</html>

